\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{babel}
\usepackage{xcolor}
\usepackage{Commands}

\usetheme{Darmstadt}

\title{Hint-based unification for STLC}
\author{Wojciech Ko≈Çowski}
\date{}

\begin{document}

\frame{\titlepage}

\section{Output contexts}

\begin{frame}{Terms, contexts and judgements}

Terms: \\
$e ::=$ \\
\qquad $x \pipe \annot{e}{H} \pipe $ \\
\qquad $\fun{x}{e} \pipe \app{e_1}{e_2} \pipe$ \\
\qquad $\pair{e_1}{e_2} \pipe \outl{e} \pipe \outr{e} \pipe$ \\
\qquad $\inl{e} \pipe \inr{e} \pipe \case{e}{e_1}{e_2} \pipe$ \\
\qquad $\unit \pipe \exfalso{e}$

\vspace{1em}

Contexts: \\
$\Gamma ::= \emptytypingctx \pipe \extend{\Gamma}{x}{H}$

\vspace{2em}

Judgements: \\
$\fulloutctx{\Gamma}{e}{H}{H'}{\Gamma'}$ -- in context $\Gamma$, term $e$ checks with hint $H$ and infers hint $H'$ in output context $\Gamma'$

\end{frame}

\begin{frame}{Output contexts -- basic rules}

\begin{center}
  $\infrule[Var]{}{\fulloutctx{\Gamma_1, x : A, \Gamma_2}{x}{B}{\combinehints{A}{B}}{\Gamma_1, x : \combinehints{A}{B}, \Gamma_2}}$

  \vspace{2em}

  $\infrule[Annot]{\outctx{e}{\combinehints{A}{B}}{C}}{\outctx{\annot{e}{A}}{B}{C}}$

  \vspace{2em}

  $\infrule[Hole]{\outctx{e}{\hintfor{e}}{A} \quad \sidecond{e\ \texttt{constructor}}}{\outctx{e}{\Hole}{A}}$
\end{center}

\vspace{2em}

Note that the rule $\rulename{Hole}$ can only be applied once, because $\hintfor{e}$ can never be $\Hole$. After applying $\rulename{Hole}$, the only applicable rules are the type-directed ones.

\end{frame}

\begin{frame}{Output contexts -- type-directed rules}

\begin{center}
  $\infrule{\fulloutctx{\extend{\Gamma}{x}{A}}{e}{B}{B'}{\extend{\Gamma'}{x}{A'}}}{\outctx{\fun{x}{e}}{\Fun{A}{B}}{\Fun{A'}{B'}}}$

  \vspace{1em}

  $\infrule{\fulloutctx{\Gamma}{f}{\Fun{\Hole}{B}}{\Fun{A}{B'}}{\Gamma'} \quad \fulloutctx{\Gamma'}{a}{A}{A'}{\Gamma''}}{\fulloutctx{\Gamma}{\app{f}{a}}{B}{B'}{\Gamma''}}$

  \vspace{1em}

  $\infrule{\fulloutctx{\Gamma}{a}{A}{A'}{\Gamma'} \quad \fulloutctx{\Gamma'}{b}{B}{B'}{\Gamma''}}{\fulloutctx{\Gamma}{\pair{a}{b}}{\Prod{A}{B}}{\Prod{A'}{B'}}{\Gamma''}}$

  \vspace{1em}

  $\infrule{\outctx{e}{\Prod{A}{\Hole}}{\Prod{A'}{B}}}{\outctx{\outl{e}}{A}{A'}}$
  \quad
  $\infrule{\outctx{e}{\Prod{\Hole}{B}}{\Prod{A}{B'}}}{\outctx{\outr{e}}{B}{B'}}$
\end{center}

\end{frame}

\begin{frame}{Output contexts -- type-directed rules}

\begin{center}
  $\infrule{\outctx{e}{A}{A'}}{\outctx{\inl{e}}{\Sum{A}{B}}{\Sum{A'}{B}}}$

  \vspace{2em}

  $\infrule{\outctx{e}{B}{B'}}{\outctx{\inr{e}}{\Sum{A}{B}}{\Sum{A}{B'}}}$

  \vspace{2em}

  $\infrule{\fulloutctx{\Gamma}{e}{\Sum{\Hole}{\Hole}}{\Sum{A}{B}}{\Gamma_1} \quad \begin{array}{c} \fulloutctx{\Gamma_1}{f}{\Fun{A}{C_1}}{\Fun{A'}{C_2}}{\Gamma_2} \\ \fulloutctx{\Gamma_2}{g}{\Fun{B}{C_2}}{\Fun{B'}{C_3}}{\Gamma_3} \end{array}}{\fulloutctx{\Gamma}{\case{e}{f}{g}}{C_1}{C_3}{\Gamma_3}}$

  \vspace{2em}

  $\infrule{}{\outctx{\unit}{\Unit}{\Unit}}$
  \quad
  $\infrule{\outctx{e}{\Empty}{\Empty}}{\outctx{\exfalso{e}}{A}{A}}$
\end{center}

\end{frame}

\begin{frame}{Output contexts -- abridged basic rules}

\begin{center}
  $\infrule[Var]{}{\fulloutctx{\Gamma_1, x : A, \Gamma_2}{x}{B}{\combinehints{A}{B}}{\Gamma_1, x : \combinehints{A}{B}, \Gamma_2}}$

  \vspace{2em}

  $\infrule[Annot]{\shortoutctx{e}{\combinehints{A}{B}}{C}}{\shortoutctx{\annot{e}{A}}{B}{C}}$

  \vspace{2em}

  $\infrule[Hole]{\shortoutctx{e}{\hintfor{e}}{A} \quad \sidecond{e\ \texttt{constructor}}}{\shortoutctx{e}{\Hole}{A}}$
\end{center}

\vspace{2em}

Note that the rule $\rulename{Hole}$ can only be applied once, because $\hintfor{e}$ can never be $\Hole$. After applying $\rulename{Hole}$, the only applicable rules are the type-directed ones.

\end{frame}

\begin{frame}{Output contexts -- abridged type-directed rules}

\begin{center}
  $\infrule{\fulloutctx{\extend{\Gamma}{x}{A}}{e}{B}{B'}{\extend{\Gamma'}{x}{A'}}}{\outctx{\fun{x}{e}}{\Fun{A}{B}}{\Fun{A'}{B'}}}$

  \vspace{1em}

  $\infrule{\fulloutctx{\Gamma}{f}{\Fun{\Hole}{B}}{\Fun{A}{B'}}{\Gamma'} \quad \fulloutctx{\Gamma'}{a}{A}{A'}{\Gamma''}}{\fulloutctx{\Gamma}{\app{f}{a}}{B}{B'}{\Gamma''}}$

  \vspace{1em}

  $\infrule{\fulloutctx{\Gamma}{a}{A}{A'}{\Gamma'} \quad \fulloutctx{\Gamma'}{b}{B}{B'}{\Gamma''}}{\fulloutctx{\Gamma}{\pair{a}{b}}{\Prod{A}{B}}{\Prod{A'}{B'}}{\Gamma''}}$

  \vspace{1em}

  $\infrule{\shortoutctx{e}{\Prod{A}{\Hole}}{\Prod{A'}{B}}}{\shortoutctx{\outl{e}}{A}{A'}}$
  \quad
  $\infrule{\shortoutctx{e}{\Prod{\Hole}{B}}{\Prod{A}{B'}}}{\shortoutctx{\outr{e}}{B}{B'}}$
\end{center}

\end{frame}

\begin{frame}{Output contexts -- abridged type-directed rules}

\begin{center}
  $\infrule{\shortoutctx{e}{A}{A'}}{\shortoutctx{\inl{e}}{\Sum{A}{B}}{\Sum{A'}{B}}}$

  \vspace{2em}

  $\infrule{\shortoutctx{e}{B}{B'}}{\shortoutctx{\inr{e}}{\Sum{A}{B}}{\Sum{A}{B'}}}$

  \vspace{2em}

  $\infrule{\fulloutctx{\Gamma}{e}{\Sum{\Hole}{\Hole}}{\Sum{A}{B}}{\Gamma_1} \quad \begin{array}{c} \fulloutctx{\Gamma_1}{f}{\Fun{A}{C_1}}{\Fun{A'}{C_2}}{\Gamma_2} \\ \fulloutctx{\Gamma_2}{g}{\Fun{B}{C_2}}{\Fun{B'}{C_3}}{\Gamma_3} \end{array}}{\fulloutctx{\Gamma}{\case{e}{f}{g}}{C_1}{C_3}{\Gamma_3}}$

  \vspace{2em}

  $\infrule{}{\shortoutctx{\unit}{\Unit}{\Unit}}$
  \quad
  $\infrule{\shortoutctx{e}{\Empty}{\Empty}}{\shortoutctx{\exfalso{e}}{A}{A}}$
\end{center}

\end{frame}

\section{Unification}

\newcommand{\extendunif}[2]{#1, #2}
\newcommand{\extendunifdef}[3]{#1, #2 := #3}

\newcommand{\fulluniftyping}[5]{#1 \vdash #2 \mathcolor{blue}{\Leftarrow} #3 \mathcolor{red}{\Rightarrow} #4 \dashv #5}
\newcommand{\uniftyping}[3]{\fulluniftyping{\Gamma}{#1}{#2}{#3}{\Gamma'}}
\newcommand{\shortuniftyping}[3]{#1 \mathcolor{blue}{\Leftarrow} #2 \mathcolor{red}{\Rightarrow} #3}

\begin{frame}{Types, holes, terms and contexts}

Holes: \\
$H ::= \alpha \pipe \Fun{H_1}{H_2} \pipe \Prod{H_1}{H_2} \pipe \Sum{H_1}{H_2} \pipe \Unit \pipe \Empty$

\vspace{2em}

Terms: \\
$e ::=$ \\
\qquad $x \pipe \annot{e}{H} \pipe $ \\
\qquad $\fun{x}{e} \pipe \app{e_1}{e_2} \pipe$ \\
\qquad $\pair{e_1}{e_2} \pipe \outl{e} \pipe \outr{e} \pipe$ \\
\qquad $\inl{e} \pipe \inr{e} \pipe \case{e}{e_1}{e_2} \pipe$ \\
\qquad $\unit \pipe \exfalso{e}$

\vspace{2em}

Note: the terms are the same as in STLC with Hints.

\end{frame}

\begin{frame}{Contexts and judgements}

Contexts: \\
$\Gamma ::= \emptytypingctx \pipe \extend{\Gamma}{x}{A} \pipe \extendunif{\Gamma}{\alpha} \pipe \extendunifdef{\Gamma}{\alpha}{H}$

\vspace{2em}

We introduce unification variables, denoted with Greek letter ($\alpha, \beta, \gamma, \dots$). When extending the context with a unification variable, it is set to some hint, which at the beginning will be just $\Hole$.

\vspace{2em}

Judgements: \\
$\fulluniftyping{\Gamma}{e}{H}{H'}{\Gamma'}$ -- in context $\Gamma$, term $e$ checks with hint $H$ and infers hint $H'$ in output context $\Gamma'$

\end{frame}

\end{document}